<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Event handling</title>
        <script type="text/javascript" src="../../../dist/sizzle.js"></script>
        <script type="text/javascript" src="../../../dist/joy.js"></script>
        <script type="text/javascript">
          function setup() {
            Joy.debug = true;

            var engine = new Joy.Engine({ canvas2d: document.getElementById('joy') });

            var scene = engine.createScene();
            scene.fillStyle("#BFE5E5");
            scene.fillRect(0, 0, engine.width, engine.height);

            var block = new Joy.DisplayObject({x: 0, y: engine.height-20});
            block.fillStyle("#000");
            block.fillRect(0,0,1,1);
            block.scale(engine.width, 20);
            scene.addChild(block);

            var mario1 = new Joy.Sprite({ x: engine.width / 2, y: engine.height / 2, src: "../shared-assets/mario.png" });
            mario1.vspeed = 0;
            mario1.hspeed = 0;
            mario1.maxHSpeed = 3;
            mario1.maxVSpeed = 5;

            mario1.bind(Joy.Events.KEY_PRESS, function(evt) {
              console.log("Key press!", evt.keyCode, this.hspeed);
              if (evt.keyCode === Joy.Keyboard.LEFT) {
                if (this.hspeed > -this.maxHSpeed) {
                  this.hspeed -= 0.2;
                }
              } else if (evt.keyCode === Joy.Keyboard.RIGHT) {
                if (this.hspeed < this.maxHSpeed) {
                  this.hspeed += 0.2;
                }
              }
            });

            mario1.bind(Joy.Events.UPDATE, function() {
              if (!this.grounded) {

                // Limit vspeed
                if (this.vspeed < this.maxVSpeed)  {
                  this.vspeed += 0.1;
                }

                this.y += this.vspeed;
              }

              // Reduce hspeed
              if (this.hspeed > 0.05) {
                this.hspeed -= 0.05;
              } else if (this.hspeed < -0.05) {
                this.hspeed += 0.05;
              }

              this.x += this.hspeed;
            });

            mario1.onCollide(block, function() {
              // console.log("Colliding with block...");
              this.grounded = true;
            });
            scene.addChild(mario1);
          }
        </script>
    </head>

    <body onload="setup();">
        <canvas id="joy" width='800' height='600' style="border: 1px solid #666;"></canvas>
    </body>

</html>
