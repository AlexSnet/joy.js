<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Event handling</title>
        <script type="text/javascript" src="../../dist/sizzle.js"></script>
        <script type="text/javascript" src="../../dist/joy.js"></script>
        <script type="text/javascript">
          function setup() {
            Joy.debug = true;

            var engine = new Joy.Engine({ canvas2d: document.getElementById('joy') });
            var scene = engine.createScene();
            scene.background("#BFE5E5");

            var block = new Joy.Shape({geom: new Joy.Rect(engine.width - 100, 20)}).fillStyle("#000");
            block.y = engine.height - 20;
            block.x = 50;
            scene.addChild(block);

            var mario1 = new Joy.Sprite({ x: engine.width / 2, y: engine.height / 2, src: "../shared-assets/mario.png" });
            mario1.vspeed = 0;
            mario1.maxVSpeed = 5;

            mario1.bind(Joy.Events.KEY_PRESS, function(evt) {
              console.log("Key press!", evt.keyCode);
              if (evt.keyCode == Joy.Keyboard.SPACE && this.grounded) {
                this.vspeed = -4;
                this.grounded = false;
              } if (evt.keyCode === Joy.Keyboard.LEFT) {
                this.x -= 1;
              } else if (evt.keyCode === Joy.Keyboard.RIGHT) {
                this.x += 1;
              }
            });

            mario1.bind(Joy.Events.UPDATE, function() {
              if (!this.grounded) {

                // Limit vspeed
                if (this.vspeed < this.maxVSpeed)  {
                  this.vspeed += 0.15;
                }

                this.y += this.vspeed;
              }
            });

            mario1.onCollide(block, function() {
              this.y -= 1;
              this.grounded = true;
            });
            scene.addChild(mario1);
          }
        </script>
    </head>

    <body onload="setup();">
        <canvas id="joy" width='800' height='600' style="border: 1px solid #666;"></canvas>
    </body>

</html>
