/* 
 * Joy.js - v0.0.1pre (http://joyjs.org)
 * Copyright (c) 2012 Joy.js Foundation and other contributors 
 * Build date: 12/19/2012
 */
(function(e){var t=e.Joy||{Init:{},Render:{},Input:{},Context:{},debug:!1};e.Joy=t})(window),function(){var e=!1,t=/xyz/.test(function(){"xyz";})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o}}(),function(e){var t=function(e){this.setCanvas(e.canvas),this.setSmooth(!1)};t.prototype.setSmooth=function(e){return this.ctx.imageSmoothingEnabled=e,this.ctx.mozImageSmoothingEnabled=e,this.ctx.oImageSmoothingEnabled=e,this.ctx.webkitImageSmoothingEnabled=e,this},t.prototype.setCanvas=function(e){return this.canvas=e,this.ctx=e.getContext("2d"),this},t.prototype.clear=function(){return this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this},t.prototype.render=function(e){var t=e.length,n=0;this.clear();for(;n<t;++n)e[n].render()},e.Context.Context2d=t}(Joy),function(e){var t=Class.extend({init:function(){this.ctx=null,this.index=null,this._parent=null,this.alpha=1,this.scaleX=1,this.scaleY=1,this._visible=!0,this.__defineGetter__("parent",function(){return this._parent}),this.__defineSetter__("visible",function(e){this._visible=e}),this.__defineGetter__("visible",function(){return this._visible&&this.alpha>0&&this.scaleX!==0&&this.scaleY!==0}),this._contextOperations={}},setContext:function(e){this.ctx=e},scale:function(e,t){return this.scaleX=e,this.scaleY=t,this._contextOperations.scale=[this.scaleX,this.scaleY],this},translate:function(e,t){return this._contextOperations.translate=[e,t],this},fillStyle:function(e){this._contextOperations.fillStyle=e.toString()},fillRect:function(e,t,n,r){this._contextOperations.fillRect=[e,t,n,r]},shadow:function(e){this._contextOperations.shadowColor=e.color||"#000",this._contextOperations.shadowOffsetX=e.offsetX||0,this._contextOperations.shadowOffsetY=e.offsetY||0,this._contextOperations.shadowBlur=e.blur||1},render:function(){for(var e in this._contextOperations)this._contextOperations[e]instanceof Array?this.ctx[e].apply(this.ctx,this._contextOperations[e]):this.ctx[e]=this._contextOperations[e]}});e.DisplayObject=t}(Joy),function(e){var t=e.DisplayObject.extend({init:function(){this._super(),this.displayObjects=[]},render:function(){var e=0,t=this.displayObjects.length;this.ctx.save(),this._super();for(;e<t;++e){if(!this.displayObjects[e].visible)continue;this.ctx.save(),this.displayObjects[e].render(),this.ctx.restore()}this.ctx.restore()},swapChildren:function(e,t){var n=e.index;return this.displayObjects[n]=t,this.displayObjects[t.index]=e,e.index=t.index,t.index=n,this},addChild:function(e){e.index=this.displayObjects.push(e)-1,e._parent=this},removeChild:function(e){},removeChildAt:function(e){}});e.DisplayObjectContainer=t}(Joy),function(e){var t=e.DisplayObject.extend({init:function(e){this._super(),this.asset=e.asset||new Image,this.x=this._x=e.x||0,this.y=this._y=e.y||0,this._width=this.asset.width||e.width,this._height=this.asset.height||e.height,this.width=this._width,this.height=this._height,this.flipX=!1,this.flipY=!1,this.frames=1,this.currentFrame=0,e.src&&this.load(e.src),this.scale(1,1)},scale:function(e,t){this._super(e,t),this.width=this._width*this.scaleX,this.height=this._height*this.scaleY},load:function(e){var t=this;onload&&(this.asset.onload=function(){t.onLoad()}),this.asset.src=e},onLoad:function(){this._width||(this._width=this.asset.width),this._height||(this._height=this.asset.height),this.scale(this.scaleX,this.scaleY),this._width<this.asset.width&&(this.frames=Math.ceil(this.asset.width/this._width))},render:function(){if(this.flipX===!0||this.flipY===!0)this.ctx.translate((this.flipX-0)*this._width,(this.flipY-0)*this._height),this.ctx.scale(this.flipX===!0?-1:1,this.flipY===!0?-1:1);this._x=this.x*this.ctx.canvas.width/(this.scaleX*this.ctx.canvas.width),this._y=this.y*this.ctx.canvas.height/(this.scaleY*this.ctx.canvas.height),this._super(),this.ctx.drawImage(this.asset,this._width*this.currentFrame,0,this._width,this._height,this._x,this._y,this._width,this._height),e.debug&&(this.ctx.strokeStyle="red",this.ctx.strokeRect(this._x,this._y,this._width,this._height))}});e.Sprite=t}(Joy),function(e){var t=function(){};e.SpriteSheet=t}(Joy),function(e){var t={TOP:"top",HANGING:"hanging",MIDDLE:"middle",ALPHABETIC:"alphabetic",IDEOGRAPHIC:"ideographic",BOTTOM:"bottom"},n="Normal 12px Verdana",r="#000000",i="left",s=t.TOP,o=e.DisplayObject.extend({init:function(e){typeof e=="undefined"&&(e={}),this.x=e.x||0,this.y=e.y||0,this.text=e.text||"",this.font=e.font||n,this.align=e.align||i,this.baseline=e.baseline||s,this._color=e.color||r,this.__defineGetter__("color",function(){return this._color}),this.__defineSetter__("color",function(e){this._color=e.toString()}),e.stroke?this.useStroke():this.useFill(),this._super()},useStroke:function(){this.stroke=!0,this.fillMethod="strokeText",this.styleMethod="strokeStyle"},useFill:function(){this.stroke=!1,this.fillMethod="fillText",this.styleMethod="fillStyle"},render:function(){this.ctx.font=this.font,this.ctx.textAlign=this.align,this.ctx.textBaseline=this.baseline,this.ctx[this.styleMethod]=this.color,this.ctx[this.fillMethod](this.text,this.x,this.y)},getMeasure:function(){this.ctx.measureText(this.text)}});o.BASELINE=t,e.Text=o}(Joy),function(e){var t=Class.extend({init:function(e){this.engine=null,this.visible=!0,this.x=0,this.y=0,this.graphic=e.graphic||null,this._intervals={},this._behaviours=[]},bind:function(t,n){var r=e.Behaviour.extend({});r.prototype[t]=n,this.addBehaviour(r)},addBehaviour:function(e){var t=this,n=new e;n.update&&!this._intervals.update&&this.addInterval("update",function(){n.update.apply(t)},100),this._behaviours.push(n)},addInterval:function(e,t,n){this._intervals[e]&&clearInterval(this._intervals[e]),this._intervals[e]=setInterval(t,n)},update:function(){var e=0,t=this._behaviours.length;for(;e<t;++e)this._behaviours[e].update.apply(this)}});e.Actor=t}(Joy),function(e){var t=Class.extend({init:function(){}});Joy.Behaviour=t}(Joy),function(e){var t=e.DisplayObjectContainer.extend({init:function(e){this._super(),this.actors=[]},addChild:function(t){var n;t instanceof e.Actor?(this.actors.push(t),n=t.graphic):n=t,n.setContext(this.ctx),this._super(n)}});e.Scene=t}(Joy),function(e){var t=null,n=function(e){t=this,this.scenes=[],e.canvas2d&&(this.context=new Joy.Context.Context2d({canvas:e.canvas2d})),e.canvas3d,e.markup&&this.useMarkup(),this.__defineGetter__("width",function(){return this.context.canvas.width}),this.__defineGetter__("height",function(){return this.context.canvas.height}),Joy.debug?(this._lastRenderTime=new Date,this._frameRateText=new Joy.Text({x:4,y:4,font:"12px Verdana",color:"red"}),this.onEnterFrameDebug()):this.onEnterFrame()};n.prototype.createScene=function(){var t=new e.Scene;return this.addScene(t),t},n.prototype.addScene=function(e){e.setContext(this.context.ctx),Joy.debug&&e.addChild(this._frameRateText),this.scenes.push(e)},n.prototype.render=function(){this.context.render(this.scenes)},n.prototype.useMarkup=function(){var t=new e.Markup;t.analyse(this.context)},n.prototype.onEnterFrame=function(){t.render(),window.onEnterFrame(t.onEnterFrame)},n.prototype.onEnterFrameDebug=function(){var e=new Date;t._frameRateText.text=(1e3/(e-t._lastRenderTime)).toFixed(1).toString()+" FPS",t.render(),t._lastRenderTime=e,window.onEnterFrame(t.onEnterFrameDebug)},e.Engine=n}(Joy),function(J){var $=typeof Sizzle!="undefined"?Sizzle:null,Markup=function(){};Markup.prototype.analyse=function(e){var t,n,r,i=$("img",e.canvas);n=i.length;for(t=0;t<n;++t)r=this.evaluateDataset.call(i[t],i[t].dataset,e.context),e.addChild(new Joy.Sprite({x:i[t].dataset.x,y:i[t].dataset.y,asset:i[t]}));var s=$("label",e.canvas);n=s.length;for(t=0;t<n;++t)r=this.evaluateDataset(s[t].dataset,e.context),r.text=s[t].innerHTML,e.addChild(new Joy.Text(r))},Markup.prototype.evaluateDataset=function(dataset,context){var attr,matches,width=context.canvas.width,height=context.canvas.height;for(var key in dataset)attr=dataset[key],matches=attr.match(/\{\{([^\}]*)\}\}/),matches&&(dataset[key]=attr.replace(attr,eval(matches[1])));return dataset},J.Markup=Markup}(Joy),function(e){var t=function(){};e.Package=t}(Joy),Joy.Time={deltaTime:1},function(e){var t=function(e,t,n,r){!t&&!n?this.value=e:r?this.value="rgba("+e+","+t+","+n+","+r+")":this.value="rgb("+e+","+t+","+n+")"};t.prototype.toString=function(){return this.value},e.Color=t}(Joy),function(e){var t={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222};Joy.Keyboard=t}(Joy),window.onEnterFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();