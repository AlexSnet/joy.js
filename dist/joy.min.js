/* 
 * Joy.js - v0.0.1pre (http://joyjs.org)
 * Copyright (c) 2012 Joy.js Foundation and other contributors 
 * Build date: 12/16/2012
 */
(function(e){var t=e.Joy||{Init:{},Render:{},Input:{},Context:{},debug:!1};e.Joy=t})(window),window.onEnterFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),function(){var e=!1,t=/xyz/.test(function(){"xyz";})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o}}(),function(e){var t=null,n=function(e){t=this,this.actors=[],e.canvas2d&&(this.context=new Joy.Context.Context2d({canvas:e.canvas2d})),e.canvas3d,e.markup&&this.useMarkup(),this.onEnterFrame()};n.prototype.getHeight=function(){return this.context.canvas.height},n.prototype.getWidth=function(){return this.context.canvas.width},n.prototype.addChild=function(t){var n;return t instanceof e.Actor?(this.actors.push(t),n=t.graphic):n=t,this.context.addChild(n)},n.prototype.render=function(){this.context.render()},n.prototype.useMarkup=function(){var t=new e.Markup;t.analyse(this.context)},n.prototype.onEnterFrame=function(){t.render(),window.onEnterFrame(t.onEnterFrame)},e.Engine=n}(Joy),function(e){var t=Class.extend({init:function(){this.ctx=null,this.plugins=[],this._preRender=[],this._postRender=[]},setContext:function(e){var t=0,n=this.plugins.length;this.ctx=e;for(;t<n;++t)this.plugins[t].setContext(e)},addPlugin:function(e){e.preRender&&this._preRender.push(e),e.postRender&&this._postRender.push(e),this.plugins.push(e)},preRender:function(){var e=0,t=this._preRender.length;for(;e<t;++e)this._preRender[e].preRender()},postRender:function(){var e=0,t=this._postRender.length;for(;e<t;++e)this._postRender[e].postRender()},render:function(){throw new Exception("You must override `render` method for `"+this.constructor+"`.")}});e.Renderable=t}(Joy),Joy.Time={deltaTime:1},function(e){var t=Class.extend({init:function(e){this.engine=null,this.x=0,this.y=0,this.graphic=e.graphic||null,this._intervals={},this._behaviours=[]},bind:function(t,n){var r=e.Behaviour.extend({});r.prototype[t]=n,this.addBehaviour(r)},addBehaviour:function(e){var t=this,n=new e;n.update&&!this._intervals.update&&this.addInterval("update",function(){n.update.apply(t)},100),this._behaviours.push(n)},addInterval:function(e,t,n){this._intervals[e]&&clearInterval(this._intervals[e]),this._intervals[e]=setInterval(t,n)},update:function(){var e=0,t=this._behaviours.length;for(;e<t;++e)this._behaviours[e].update.apply(this)}});e.Actor=t}(Joy),function(e){var t=Class.extend({init:function(){}});Joy.Behaviour=t}(Joy),function(J){var $=typeof Sizzle!="undefined"?Sizzle:null,Markup=function(){};Markup.prototype.analyse=function(e){that=this,$("img",e.canvas).forEach(function(t){var n=that.evaluateDataset(t.dataset,e.context);e.addChild(new Joy.Sprite({x:t.dataset.x,y:t.dataset.y,asset:t}))}),$("label",e.canvas).forEach(function(t){var n=that.evaluateDataset(t.dataset,e.context);n.text=t.innerHTML,e.addChild(new Joy.Text(n))})},Markup.prototype.evaluateDataset=function(dataset,context){var attr,matches,width=context.width,height=context.height;for(var key in dataset)attr=dataset[key],matches=attr.match(/\{\{([^\}]*)\}\}/)[1],attr.replace(attr,eval(matches[1]))},J.Markup=Markup}(Joy),function(J){var $=Sizzle,Markup=function(){};Markup.prototype.analyse=function(e){that=this,$("img",e.canvas).forEach(function(t){var n=that.evaluateDataset(t.dataset,e.context);e.addChild(new Joy.Sprite({x:t.dataset.x,y:t.dataset.y,asset:t}))}),$("label",e.canvas).forEach(function(t){var n=that.evaluateDataset(t.dataset,e.context);n.text=t.innerHTML,e.addChild(new Joy.Text(n))})},Markup.prototype.evaluateDataset=function(dataset,context){var attr,matches,width=context.width,height=context.height;for(var key in dataset)attr=dataset[key],matches=attr.match(/\{\{([^\}]*)\}\}/)[1],attr.replace(attr,eval(matches[1]))},J.Markup=Markup}(Joy),function(e){var t=function(e){this.canvas=e.canvas,this.context=this.canvas.getContext("2d"),this.setSmooth(!1),this.spriteBuffer={},this.pipeline=[]};t.prototype.setSmooth=function(e){return this.context.imageSmoothingEnabled=e,this.context.mozImageSmoothingEnabled=e,this.context.oImageSmoothingEnabled=e,this.context.webkitImageSmoothingEnabled=e,this},t.prototype.setCanvas=function(e){return this.canvas=e,this},t.prototype.addChild=function(e){e.setContext(this.context),this.pipeline.push(e)},t.prototype.removeChild=function(){},t.prototype.clear=function(){return this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this},t.prototype.render=function(){var e=this.pipeline.length,t=0;this.clear();for(;t<e;++t)this.pipeline[t]._preRender.length>0&&this.pipeline[t].preRender(),this.pipeline[t].render(),this.pipeline[t]._postRender.length>0&&this.pipeline[t].postRender()},e.Context.Context2d=t}(Joy),function(e){var t="#000000",n=e.Renderable.extend({init:function(e){this.color=e.color||t,this.offsetX=e.offsetX||0,this.offsetY=e.offsetY||0,this.blur=e.blur||0,this._super()},preRender:function(){this.ctx.save(),this.ctx.shadowColor=this.color,this.ctx.shadowBlur=this.blur,this.ctx.shadowOffsetX=this.offsetX,this.ctx.shadowOffsetY=this.offsetY},postRender:function(){this.ctx.restore()}});Joy.Render.Shadow=n}(Joy),function(e){var t=e.Renderable.extend({init:function(e){this.asset=e.asset||new Image,this.x=e.x||0,this.y=e.y||0,this.width=e.width,this.height=e.height,this.flipX=!1,this.flipY=!1,this.frames=1,this.currentFrame=0,e.src&&this.load(e.src),this._super()},load:function(e){var t=this;onload&&(this.asset.onload=function(){t.onLoad()}),this.asset.src=e},onLoad:function(){this.width||(this.width=this.asset.width),this.height||(this.height=this.asset.height),this.width<this.asset.width&&(this.frames=Math.ceil(this.asset.width/this.width)),console.log("Number of frames: "+this.frames)},render:function(){this.ctx.save();if(this.flipX===!0||this.flipY===!0)this.ctx.translate((this.flipX-0)*this.width,(this.flipY-0)*this.height),this.ctx.scale(this.flipX===!0?-1:1,this.flipY===!0?-1:1);this.ctx.drawImage(this.asset,this.width*this.currentFrame,0,this.width,this.height,this.x,this.y,this.width,this.height),e.debug&&(this.ctx.strokeStyle="red",this.ctx.strokeRect(this.x,this.y,this.width,this.height)),this.ctx.restore()}});e.Sprite=t}(Joy),function(e){var t={TOP:"top",HANGING:"hanging",MIDDLE:"middle",ALPHABETIC:"alphabetic",IDEOGRAPHIC:"ideographic",BOTTOM:"bottom"},n="Normal 12px Verdana",r="#000000",i="left",s=t.TOP,o=e.Renderable.extend({init:function(e){typeof e=="undefined"&&(e={}),this.x=e.x||0,this.y=e.y||0,this.text=e.text||"",this.font=e.font||n,this.color=e.color||r,this.align=e.align||i,this.baseline=e.baseline||s,e.stroke?this.useStroke():this.useFill(),this._super()},useStroke:function(){this.stroke=!0,this.fillMethod="strokeText",this.styleMethod="strokeStyle"},useFill:function(){this.stroke=!1,this.fillMethod="fillText",this.styleMethod="fillStyle"},render:function(){this.ctx.font=this.font,this.ctx.textAlign=this.align,this.ctx.textBaseline=this.baseline,this.ctx[this.styleMethod]=this.color,this.ctx[this.fillMethod](this.text,this.x,this.y)},getMeasure:function(){this.ctx.measureText(this.text)}});o.BASELINE=t,e.Text=o}(Joy),function(e){var t={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222};Joy.Keyboard=t}(Joy);