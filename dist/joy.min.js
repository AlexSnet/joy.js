/* 
 * Joy.js - v0.0.1pre (http://joyjs.org)
 * Copyright (c) 2012 Joy.js Foundation and other contributors 
 * Build date: 12/15/2012
 */
(function(e){var t=e.Joy||{Init:{},Render:{},Input:{},Context:{}};e.Joy=t})(window),window.onEnterFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),function(){var e=!1,t=/xyz/.test(function(){"xyz";})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o}}(),function(e){var t=function(e){return e.canvas2d&&(this.context=new Joy.Context.Context2d({canvas:e.canvas2d})),e.canvas3d,e.markup&&this.useMarkup(),this};t.prototype.getHeight=function(){return this.context.canvas.height},t.prototype.getWidth=function(){return this.context.canvas.width},t.prototype.addChild=function(e){return this.context.addChild(e)},t.prototype.render=function(){return this.context.render()},t.prototype.useMarkup=function(){var t=new e.Markup;t.analyse(this.context)},e.Engine=t}(Joy),function(e){var t=Class.extend({init:function(){this.ctx=null},setContext:function(e){this.ctx=e},render:function(){throw new Exception("You must override `render` method for `"+this.constructor+"`.")}});e.Renderable=t}(Joy),Joy.Time={deltaTime:1},function(e){var t=function(){this.x=0,this.y=0,this.sprite=null,this.transform=null};e.GameObject=t}(Joy),function(J){var $=typeof Sizzle!="undefined"?Sizzle:null,Markup=function(){};Markup.prototype.analyse=function(e){that=this,$("img",e.canvas).forEach(function(t){var n=that.evaluateDataset(t.dataset,e.context);e.addChild(new Joy.Sprite({x:t.dataset.x,y:t.dataset.y,asset:t}))}),$("label",e.canvas).forEach(function(t){var n=that.evaluateDataset(t.dataset,e.context);n.text=t.innerHTML,e.addChild(new Joy.Text(n))})},Markup.prototype.evaluateDataset=function(dataset,context){var attr,matches,width=context.width,height=context.height;for(var key in dataset)attr=dataset[key],matches=attr.match(/\{\{([^\}]*)\}\}/)[1],attr.replace(attr,eval(matches[1]))},J.Markup=Markup}(Joy),function(J){var $=Sizzle,Markup=function(){};Markup.prototype.analyse=function(e){that=this,$("img",e.canvas).forEach(function(t){var n=that.evaluateDataset(t.dataset,e.context);e.addChild(new Joy.Sprite({x:t.dataset.x,y:t.dataset.y,asset:t}))}),$("label",e.canvas).forEach(function(t){var n=that.evaluateDataset(t.dataset,e.context);n.text=t.innerHTML,e.addChild(new Joy.Text(n))})},Markup.prototype.evaluateDataset=function(dataset,context){var attr,matches,width=context.width,height=context.height;for(var key in dataset)attr=dataset[key],matches=attr.match(/\{\{([^\}]*)\}\}/)[1],attr.replace(attr,eval(matches[1]))},J.Markup=Markup}(Joy),function(e){var t=null,n=function(e){t=this,this.canvas=e.canvas,this.context=this.canvas.getContext("2d"),this.setSmooth(!1),this.spriteBuffer={},this.pipeline=[],this.onEnterFrame()};n.prototype.setSmooth=function(e){return this.context.imageSmoothingEnabled=e,this.context.mozImageSmoothingEnabled=e,this.context.oImageSmoothingEnabled=e,this.context.webkitImageSmoothingEnabled=e,this},n.prototype.setCanvas=function(e){return this.canvas=e,this},n.prototype.addChild=function(e){e.setContext(this.context),this.pipeline.push(e)},n.prototype.removeChild=function(){},n.prototype.clear=function(){return this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this},n.prototype.render=function(){var e=this.pipeline.length,t=0;this.clear();for(;t<e;++t)this.pipeline[t].render()},n.prototype.onEnterFrame=function(){window.onEnterFrame(t.onEnterFrame),t.render()},e.Context.Context2d=n}(Joy),function(e){var t=e.Renderable.extend({init:function(){},render:function(){throw new Exception("You must override `render` method for `"+this.constructor+"`.")}});Joy.Render.Shadow=t}(Joy),function(e){var t=e.Renderable.extend({init:function(e){this.ctx=null,this.asset=e.asset||new Image,this.x=e.x||0,this.y=e.y||0,e.url&&this.load(e.url)},load:function(e,t){t&&(this.asset.onload=t),this.asset.src=e},render:function(){this.ctx.drawImage(this.asset,this.x,this.y,this.asset.width,this.asset.height)}});e.Sprite=t}(Joy),function(e){var t={TOP:"top",HANGING:"hanging",MIDDLE:"middle",ALPHABETIC:"alphabetic",IDEOGRAPHIC:"ideographic",BOTTOM:"bottom"},n="normal 12px Verdana",r="#000000",i="left",s=t.TOP,o=e.Renderable.extend({init:function(e){return typeof e=="undefined"&&(e={}),this.ctx=null,this.x=e.x||0,this.y=e.y||0,this.text=e.text||"",this.font=e.font||n,this.color=e.color||r,this.align=e.align||i,this.baseline=e.baseline||s,e.stroke?this.useStroke():this.useFill(),this},useStroke:function(){this.stroke=!0,this.fillMethod="strokeText",this.styleMethod="strokeStyle"},useFill:function(){this.stroke=!1,this.fillMethod="fillText",this.styleMethod="fillStyle"},render:function(){this.ctx.font=this.font,this.ctx.textAlign=this.align,this.ctx.textBaseline=this.baseline,this.ctx[this.styleMethod]=this.color,this.ctx[this.fillMethod](this.text,this.x,this.y)},getMeasure:function(){this.ctx.measureText(this.text)}});o.BASELINE=t,e.Text=o}(Joy),function(e){var t=function(){};Joy.Input.Keyboard=t}(Joy);